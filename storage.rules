rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // This rule allows a logged-in user to write to their own designated folders.
    // It covers paths for private observations, inspections, PTWs, action photos, and profile photos.
    // Example: /observations/{userId}/file.jpg
    match /(observations|inspections|ptw-jsa|actions|profile-photos)/{userId}/{allPaths=**} {
      allow read; // Allow public read for all files, as URLs are shared.
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // This rule allows a logged-in user to write to project-specific folders,
    // but still only within their own user-specific subfolder.
    // Example: /projects/{projectId}/observations/{userId}/file.jpg
    match /projects/{projectId}/{folder=**}/{userId}/{allPaths=**} {
        allow read; // Allow public read for all files.
        allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
